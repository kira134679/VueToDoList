import{s as N,u as S,o as j,r as p,c as x,a,b as n,d as t,t as k,w as f,v as L,n as E,e as g,f as c,F as w,g as B,h as F}from"./index-DOuLBMa8.js";import{u as R,a as v}from"./axios-8KGApNBb.js";const q={id:"todoListPage",class:"bg-half"},G=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1),H={class:"d-flex align-items-center"},J={class:"todo_sm"},K={href:"#/todolist"},Q={class:"conatiner todoListPage vhContainer"},W={class:"todoList_Content"},X={class:"inputBox"},Y=["disabled"],Z={class:"todoList_list"},tt={class:"todoList_tab"},et={class:"todoList_items"},st={class:"list-group list-group-flush"},ot={key:0,class:"text-center m-2"},at=["onClick"],nt=t("span",{class:"material-symbols-outlined"},"check",-1),lt=[nt],it=["onClick"],dt=t("span",{class:"material-symbols-outlined"},"edit",-1),ct=[dt],rt={class:"todoList_label"},ut=["onUpdate:modelValue","onClick"],ht={key:1},_t=t("span",{class:"material-symbols-outlined"},"close",-1),vt=[_t],mt={key:3},pt=["onClick"],gt={class:"todoList_statistics"},bt={class:"modal fade",id:"todoErrorModal",tabindex:"-1","aria-labelledby":"todoErrorModalLabel","aria-hidden":"true"},yt={class:"modal-dialog"},kt={class:"modal-content"},ft=t("div",{class:"modal-header"},[t("h5",{class:"modal-title fw-bold",id:"todoErrorModalLabel"},"Oops!"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Et={class:"modal-body"},wt={class:"text-danger m-1"},Ct=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1),xt={__name:"TodoListPage",setup($t){const A=R(),{baseUrl:r}=N(A),C=S(),u=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");j(async()=>{u===""&&C.push("/login");const e=await v.get(`${r.value}/users/checkout`,{headers:{Authorization:u}});$.value=e.data.nickname,y()});const z=async()=>{try{const e=await v.post(`${r.value}/users/sign_out`,{},{headers:{Authorization:u}});document.cookie="todoToken=",C.push("/login")}catch(e){h.value=[e.response.data.message].flat(),new bootstrap.Modal(document.getElementById("todoErrorModal")).show()}},$=p(""),d=p([]),y=async()=>{try{const e=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1"),s=await v.get(`${r.value}/todos/`,{headers:{Authorization:e}});console.log(s),d.value=[...s.data.data]}catch(e){h.value=[e.response.data.message].flat(),new bootstrap.Modal(document.getElementById("todoErrorModal")).show()}},b=p({content:""}),P=async()=>{try{const e=await v.post(`${r.value}/todos/`,b.value,{headers:{Authorization:u}});console.log(e),b.value.content="",y()}catch(e){h.value=[e.response.data.message].flat(),new bootstrap.Modal(document.getElementById("todoErrorModal")).show()}},m=p({content:""}),U=e=>{console.log(`edit: ${e}`),d.value.forEach(s=>delete s.isEdit),d.value.filter(s=>{s.id===e&&(s.isEdit=!0,m.value.content=s.content)})},D=async e=>{if(m.value.content===e.content){console.log("變更後的內容與變更前相同，不做任何事"),T();return}try{const s=await v.put(`${r.value}/todos/${e.id}`,m.value,{headers:{Authorization:u}});e.content=m.value.content,delete e.isEdit}catch(s){h.value=[s.response.data.message].flat(),new bootstrap.Modal(document.getElementById("todoErrorModal")).show()}},h=p(""),T=()=>{d.value.forEach(e=>delete e.isEdit)},I=async e=>{console.log("delete: "+e);try{const s=await v.delete(`${r.value}/todos/${e}`,{headers:{Authorization:u}});console.log(s),y()}catch(s){h.value=[s.response.data.message].flat(),new bootstrap.Modal(document.getElementById("todoErrorModal")).show()}},O=async e=>{try{const s=await v.patch(`${r.value}/todos/${e}/toggle`,{},{headers:{Authorization:u}});console.log(s),y()}catch(s){h.value=[s.response.data.message].flat(),new bootstrap.Modal(document.getElementById("todoErrorModal")).show()}},V=x(()=>d.value.filter(e=>e.status===!1).length),_=p(0),l=Object.freeze({All:0,Pending:1,Done:2}),M=x(()=>{switch(_.value){case l.All:return d.value;case l.Pending:const e=[];return d.value.filter(o=>{o.status||e.push(o)}),e;case l.Done:const s=[];return d.value.filter(o=>{o.status&&s.push(o)}),s;default:return[]}});return(e,s)=>(a(),n(w,null,[t("div",q,[t("nav",null,[G,t("ul",H,[t("li",J,[t("a",K,[t("span",null,k($.value)+"的代辦",1)])]),t("li",null,[t("a",{class:"btn btn-outline-danger",onClick:z},"登出")])])]),t("div",Q,[t("div",W,[t("div",X,[f(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[0]||(s[0]=o=>b.value.content=o)},null,512),[[L,b.value.content]]),t("button",{class:"btn btn-dark d-flex justify-content-center",disabled:b.value.content===""},[t("span",{class:"material-symbols-outlined text-white",onClick:P}," add_task ")],8,Y)]),t("div",Z,[t("ul",tt,[t("li",null,[t("a",{class:E({active:_.value===g(l).All}),onClick:s[1]||(s[1]=o=>_.value=g(l).All)},"全部",2)]),t("li",null,[t("a",{class:E({active:_.value===g(l).Pending}),onClick:s[2]||(s[2]=o=>_.value=g(l).Pending)},"待完成",2)]),t("li",null,[t("a",{class:E({active:_.value===g(l).Done}),onClick:s[3]||(s[3]=o=>_.value=g(l).Done)},"已完成",2)])]),t("div",et,[t("ul",st,[M.value.length===0?(a(),n("div",ot,"目前尚無待辦事項")):c("",!0),(a(!0),n(w,null,B(M.value,o=>(a(),n("li",{class:"list-group-item",key:o.id},[o.isEdit?(a(),n("a",{key:0,id:"saveBtn",onClick:i=>D(o)},lt,8,at)):c("",!0),o.isEdit?c("",!0):(a(),n("a",{key:1,id:"editBtn",onClick:i=>U(o.id)},ct,8,it)),t("label",rt,[o.isEdit?c("",!0):f((a(),n("input",{key:0,class:"todoList_input",type:"checkbox","onUpdate:modelValue":i=>o.status=i,onClick:i=>O(o.id)},null,8,ut)),[[F,o.status]]),o.isEdit?c("",!0):(a(),n("span",ht,k(o.content),1)),o.isEdit?f((a(),n("input",{key:2,class:"ms-3 w-100",type:"text","onUpdate:modelValue":s[4]||(s[4]=i=>m.value.content=i)},null,512)),[[L,m.value.content]]):c("",!0)]),o.isEdit?(a(),n("a",{key:2,id:"cancelBtn",onClick:T},vt)):c("",!0),o.isEdit?c("",!0):(a(),n("a",mt,[t("span",{class:"material-symbols-outlined",onClick:i=>I(o.id)},"delete",8,pt)]))]))),128))]),t("div",gt,[t("p",null,k(V.value)+" 個待完成項目",1)])])])])])]),t("div",bt,[t("div",yt,[t("div",kt,[ft,t("div",Et,[t("ul",wt,[(a(!0),n(w,null,B(h.value,(o,i)=>(a(),n("li",{class:"p-1",key:i},k(o),1))),128))])]),Ct])])])],64))}};export{xt as default};
